<%- include ("../layouts/header") %>

<div class="content">
    <div class="container">
        <div class="page-title">
            <h3>Estadísticas</h3>
        </div>
        <div class="box box-primary">
            <div class="box-body">
                <h1>Estadísticas Mensuales</h1>

                <% if (stats && stats.length > 0) { %>
                  <table>
                    <thead>
                      <tr>
                        <th>Mes</th>
                        <th>Usuarios</th>
                        <th>Publicaciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% for (var i = 0; i < stats.length; i++) { %>
                        <tr>
                          <td><%= stats[i].month %></td>
                          <td><%= stats[i].users %></td>
                          <td><%= stats[i].posts %></td>
                        </tr>
                      <% } %>
                    </tbody>
                  </table>
                <% } else { %>
                  <p>No hay estadísticas disponibles.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<script>
    function getStats() {
        var ajax = new XMLHttpRequest();
        ajax.open("GET", "/admin/stats", true);

        ajax.onreadystatechange = function() {
            if (this.readyState == 4) {
                if (this.status == 200) {
                    var response = JSON.parse(this.responseText);
                    if (response.status == "success") {
                        var stats = response.stats;
                        // Aquí puedes manipular los datos de estadísticas recibidos
                    } else {
                        console.error(response.message);
                    }
                } else {
                    console.error("Failed to fetch monthly statistics.");
                }
            }
        };

        ajax.send();
    }

    getStats();
    var formData = new FormData();
    formData.append("accessToken", localStorage.getItem("adminAccessToken"));
</script>

<%- include ("../layouts/footer") %>
